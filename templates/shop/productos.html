<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power.Lab</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main/index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/productos.css') }}">
    <!-- Cargar √≠conos de Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
    <header class="Encabezado">
        <div class="Titulo-container">
            <a href="{{ url_for('index') }}" class="Boton-Inicio">
                <h1 class="Titulo-header">Power.Lab</h1>
                <i class="fas fa-dumbbell" style="color: #d2cfcf; font-size: 48px;"></i>
            </a>
        </div>
        <nav class="Menu-links">
            <a href="{{ url_for('perfil') }}">PERFIL</a>
            <a href="{{ url_for('productos') }}">PRODUCTOS</a>
            <a href="{{ url_for('productos') }}">DESCUENTOS</a>
            <a href="{{ url_for('mis_compras') }}">MIS COMPRAS</a>
        </nav>

        {% if session.get("user_id") %}
            <span class="Inicio-sesion">
                {% if session.get("user_tipo") == "admin" %}
                    ADMIN: Hola {{ session.get("user_nombre") }}
                {% else %}
                    Hola {{ session.get("user_nombre") }}
                {% endif %}
                <a href="{{ url_for('logout') }}" style="color: inherit; text-decoration: underline; margin-left: 10px;">Logout</a>
            </span>
        {% else %}
            <a href="{{ url_for('login_get') }}" class="Inicio-sesion">
                Iniciar sesi√≥n/<br>Registrarse
            </a>
        {% endif %}

        <a href="{{ url_for('carrito') }}" class="Boton-carrito">
            <i class="fa-solid fa-cart-shopping"></i>
            <span class="Contador">0</span>
        </a>
    </header>

    <div class="Separador-1">
        <p class="Txt-Separador-1">
            PRODUCTOS
        </p>
    </div>

    <div class="Slate-1">

        <!-- ‚úÖ FORM GET que alimenta /productos?categoria=...&marca=...&sabor=... -->
        <form class="Filtro" method="GET" action="{{ url_for('productos') }}">
            <label for="Categorias">Categorias</label>
            <select id="Categorias" name="categoria" onchange="this.form.submit()">
                <option value="" {% if not categoria %}selected{% endif %}>Todos</option>
                <option value="proteina" {% if categoria == "proteina" %}selected{% endif %}>Prote√≠na</option>
                <option value="creatina" {% if categoria == "creatina" %}selected{% endif %}>Creatina</option>
                <option value="preentreno" {% if categoria == "preentreno" %}selected{% endif %}>Pre-entreno</option>
                <option value="energia" {% if categoria == "energia" %}selected{% endif %}>Energ√≠a</option>
                <option value="preparacion_peso" {% if categoria == "preparacion_peso" %}selected{% endif %}>Preparaci√≥n y Ganador de Peso</option>
                <option value="recetas" {% if categoria == "recetas" %}selected{% endif %}>Recetas</option>
            </select>

            <label for="Marcas">Marcas</label>
            <select id="Marcas" name="marca" onchange="this.form.submit()">
                <option value="" {% if not marca %}selected{% endif %}>Todas</option>
                <!-- üëá value en min√∫scula para matchear controller/model -->
                <option value="ena" {% if marca == "ena" %}selected{% endif %}>Ena</option>
                <option value="star" {% if marca == "star" %}selected{% endif %}>Star Nutrition</option>
                <option value="granger" {% if marca == "granger" %}selected{% endif %}>Granger</option>
            </select>

            <label for="Sabores">Sabores</label>
            <select name="sabor" id="Sabores" onchange="this.form.submit()">
                <option value="" {% if not sabor %}selected{% endif %}>Todas</option>
                <option value="chocolate" {% if sabor == "chocolate" %}selected{% endif %}>Chocolate</option>
                <option value="vainilla" {% if sabor == "vainilla" %}selected{% endif %}>Vainilla</option>
                <option value="cookiescream" {% if sabor == "cookiescream" %}selected{% endif %}>Cookies & Cream</option>
                <option value="strawberry" {% if sabor == "strawberry" %}selected{% endif %}>Strawberry</option>
                <option value="neutro" {% if sabor == "neutro" %}selected{% endif %}>Neutro</option>
                <option value="fruitpunch" {% if sabor == "fruitpunch" %}selected{% endif %}>Fruit Punch</option>
                <option value="citrus" {% if sabor == "citrus" %}selected{% endif %}>Citrus</option>
                <option value="uva" {% if sabor == "uva" %}selected{% endif %}>Uva</option>
                <option value="lemonade" {% if sabor == "lemonade" %}selected{% endif %}>Lemonade</option>
            </select>

            <!-- Bot√≥n opcional (por si quer√©s filtrar sin onchange). Si no lo quer√©s, borrarlo. -->
            <noscript>
                <button type="submit">Filtrar</button>
            </noscript>
        </form>

        <div class="Catalogo">
            {% if productos and productos|length > 0 %}
                {% for p in productos %}
                    <div class="Producto">
                        <div class="Imagen">
                            {% set img = (p[6] or "") %}
                            {% if img.startswith("http") %}
                                <img src="{{ img }}" alt="{{ p[1] }}">
                            {% else %}
                                <img src="{{ url_for('static', filename='img/productos/' ~ img) }}" alt="{{ p[1] }}">
                            {% endif %}
                        </div>

                        <p class="Txt">
                            {{ p[1] }} <br>
                            Precio: ${{ p[4] }} <br>

                            {% if p[5] and p[5] > 0 %}
                                En stock
                            {% else %}
                                Sin stock
                            {% endif %}
                        </p>

                        <a href="{{ url_for('item', id_producto=p[0]) }}" class="Boton-compra">Comprar</a>
                    </div>
                {% endfor %}
            {% else %}
                <p style="color:white;">No hay productos para mostrar.</p>
            {% endif %}
        </div>
    </div>

    <footer class="Pie-pagina">
        <div class="Slogan">
            <p>
                <span class="Resaltado-slogan">Power.Lab</span><br>
                Suplementaci√≥n<br><br>
                Somos personas normales como t√∫,<br>
                que nos gusta el deporte y el gimnasio<br>
                y queremos ayudarte a mejorar.
            </p>
        </div>
        <div class="ANMAT">
            <p>
                Productos regulados y verificados por la <span class="Resaltado-ANMAT">ANMAT</span>,<br> cumpliendo
                requisitos de seguridad, calidad y registro.
            </p>
        </div>
        <div class="Metodos-pago">
            <i class="fab fa-cc-visa"></i>
            <i class="fab fa-cc-mastercard"></i>
            <img src="{{ url_for('static', filename='img/logos/mercadopago.png') }}" alt="Mercado Pago">
        </div>
    </footer>
</body>
</html>